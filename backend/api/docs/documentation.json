{
  "openapi": "3.1.0",
  "info": {
    "title": "UU-IOT Smart Garden API",
    "description": "API for managing IoT nodes, plant pots, and sensor measurements",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "{protocol}://{host}:{port}/api/V1",
      "variables": {
        "protocol": {
          "default": "https",
          "enum": ["http", "https"]
        },
        "port": {
          "default": "8080",
          "enum": ["8080", "8443"]
        },
        "host": {
          "default": "localhost"
        }
      }
    }
  ],
  "tags": [
    {
      "name": "User",
      "description": "Operations performed by authenticated users"
    },
    {
      "name": "Node",
      "description": "Operations performed by IoT nodes (devices)"
    }
  ],

  "paths": {
    "/user": {
      "put": {
        "description": "Create User",
        "summary": "Create a new user",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/User"
              },
              "example": {
                "username": "john_doe",
                "email": "john_doe+ourApp@gmail.com",
                "password": "86bbad77affad64e370e576118820927a2848c7b2095ac039a770e425e15fba9c0bf9749a5281d11ecedaa52c15a2d9c050986e21898c6e691bbd64fd26dba73"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "User created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/User"
                },
                "example": {
                  "id": "123e4567-e89b-12d3-a456-426614174000",
                  "username": "john_doe",
                  "email": "john_doe+ourApp@gmail.com"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - user creation failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "CreationFailed",
                  "message": "The creation process failed due to invalid input."
                }
              }
            }
          },
          "500": {
            "description": "Server error - user creation failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "CreationFailed",
                  "message": "User creation process failed. Please try again later."
                }
              }
            }
          }
        },
        "tags": ["User"]
      },
      "post": {
        "description": "Login User",
        "summary": "Login user with email and password",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string",
                    "format": "sha512"
                  }
                }
              },
              "example": {
                "email": "john_doe@gmail.com",
                "password": "86bbad77affad64e370e576118820927a2848c7b2095ac039a770e425e15fba9c0bf9749a5281d11ecedaa52c15a2d9c050986e21898c6e691bbd64fd26dba73"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Token generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Token"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid login input",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "InvalidInput",
                  "message": "Email or password format is invalid."
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid credentials",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "AuthenticationFailed",
                  "message": "Email or password is incorrect."
                }
              }
            }
          },
          "500": {
            "description": "Server error - login failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "ServerError",
                  "message": "An internal error occurred. Please try again later."
                }
              }
            }
          }
        },
        "tags": ["User"]
      },
      "get": {
        "description": "Get User Info",
        "summary": "Retrieve user information using token",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "User retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "id": { "type": "string", "format": "uuid" },
                    "username": { "type": "string" },
                    "email": { "type": "string", "format": "email" }
                  },
                  "required": ["id", "username", "email"]
                },
                "example": {
                  "id": "123e4567-e89b-12d3-a456-426614174000",
                  "username": "john_doe",
                  "email": "john_doe+ourApp@gmail.com"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "Unauthorized",
                  "message": "Invalid or missing authentication token."
                }
              }
            }
          },
          "500": {
            "description": "Server error - failed to retrieve user info",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "ServerError",
                  "message": "An internal error occurred. Please try again later."
                }
              }
            }
          }
        },
        "tags": ["User"]
      },
      "patch": {
        "description": "Update user fields (username, email, password)",
        "summary": "Update authenticated user",
        "security": [{ "ApiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "username": { "type": "string", "maxLength": 30 },
                  "email": { "type": "string", "format": "email" },
                  "password": { "type": "string", "format": "sha512" }
                },
                "additionalProperties": false
              },
              "example": {
                "username": "john_updated",
                "email": "john_updated@example.com"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "User updated successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/User" },
                "example": {
                  "id": "123e4567-e89b-12d3-a456-426614174000",
                  "username": "john_updated",
                  "email": "john_updated@example.com"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid update payload",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "InvalidInput", "message": "Provided update data is invalid." }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to update user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      },
      "delete": {
        "description": "Delete authenticated user",
        "summary": "Delete user",
        "security": [{ "ApiKeyAuth": [] }],
        "responses": {
          "204": { "description": "User deleted successfully - no content" },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to delete user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      }
    },
    "/node": {
      "put": {
        "description": "Device registration endpoint - creates a new node with user association and returns a device token for authentication",
        "summary": "Device registration",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "userId": { "type": "string", "format": "uuid", "description": "ID of the user to associate with this node" }
                },
                "required": ["userId"],
                "additionalProperties": false
              },
              "example": {
                "userId": "123e4567-e89b-12d3-a456-426614174000"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Node created successfully with device token and default pot",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "nodeId": { "type": "string", "format": "uuid" },
                    "token": { "type": "string", "description": "64 character hex token for device authentication" },
                    "potId": { "type": "string", "format": "uuid", "description": "ID of the default pot created for this node" }
                  },
                  "required": ["nodeId", "token", "potId"]
                },
                "example": {
                  "nodeId": "6f1e2b8a-1e2d-4c3b-8c9b-a3b14f0c1234",
                  "token": "b1946ac92492d2347c6235b4d2611184f3a9f6f1c4e5b2a76f2e4d5a8b7c9d0e",
                  "potId": "d3f1a2b4-5c6d-7890-ab12-cd34ef567890"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - user not found or invalid input",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "InvalidInput", "message": "User not found." }
              }
            }
          }
        },
        "tags": ["Node"]
      },
      "get": {
        "description": "Get all nodes for authenticated user",
        "summary": "List nodes owned by the authenticated user",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "List of nodes",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Node"
                  }
                },
                "example": [
                  {
                    "id": "6f1e2b8a-1e2d-4c3b-8c9b-a3b14f0c1234",
                    "userId": "123e4567-e89b-12d3-a456-426614174000",
                    "name": "Living Room Node",
                    "note": "Main gateway",
                    "status": "active",
                    "dataArchiving": "P14D"
                  }
                ]
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to retrieve nodes",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      },
    },
    "/node/heartbeat": {
      "put": {
        "description": "Node heartbeat endpoint - allows devices to report their status without requiring nodeId in path",
        "summary": "Node heartbeat (device)",
        "security": [{ "ApiKeyAuthNode": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "timestamp": { "type": "string", "format": "date-time", "description": "Current timestamp from the device" },
                  "uptimeSec": { "type": "integer", "minimum": 0, "description": "Device uptime in seconds" },
                  "rssi": { "type": "integer", "description": "WiFi signal strength (optional)" }
                },
                "required": ["timestamp", "uptimeSec"],
                "additionalProperties": false
              },
              "example": {
                "timestamp": "2025-01-31T12:00:00Z",
                "uptimeSec": 3600,
                "rssi": -65
              }
            }
          }
        },
        "responses": {
          "204": {
            "description": "Heartbeat accepted - no content"
          },
          "400": {
            "description": "Bad request - invalid heartbeat payload",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "InvalidInput", "message": "Provided heartbeat data is invalid." }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing node token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing node authentication token." }
              }
            }
          }
        },
        "tags": ["Node"]
      }
    },
    "/node/{nodeId}": {
      "parameters": [
        {
          "name": "nodeId",
          "in": "path",
          "required": true,
          "schema": { "type": "string", "format": "uuid" },
          "description": "Identifier of the node"
        }
      ],
      "patch": {
        "description": "Update node fields (name, note, status, dataArchiving)",
        "summary": "Partial update of a node",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string", "maxLength": 50, "minLength": 3 },
                  "note": { "type": "string", "maxLength": 200 },
                  "status": { "type": "string", "enum": ["active", "inactive", "unknown"] },
                  "dataArchiving": { "type": "string", "description": "Duration in ISO 8601 format" }
                },
                "additionalProperties": false
              },
              "example": {
                "name": "Updated Node Name",
                "note": "Updated note",
                "dataArchiving": "P7D"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Node updated successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Node" },
                "example": {
                  "id": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                  "userId": "123e4567-e89b-12d3-a456-426614174000",
                  "name": "Updated Node Name",
                  "note": "Updated note",
                  "status": "active",
                  "dataArchiving": "P7D"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid update payload",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "InvalidInput", "message": "Provided update data is invalid." }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - node does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Node not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to update node",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      },
      "delete": {
        "description": "Delete a node owned by the authenticated user",
        "summary": "Delete node",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "responses": {
          "204": {
            "description": "Node deleted successfully - no content"
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - node does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Node not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to delete node",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      },
      "get": {
        "description": "Get details of a specific node owned by the authenticated user",
        "summary": "Retrieve node details",
        "security": [
          {
            "ApiKeyAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "Node details retrieved successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Node" },
                "example": {
                  "id": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                  "userId": "123e4567-e89b-12d3-a456-426614174000",
                  "name": "Garden Node",
                  "note": "Backyard sensors",
                  "status": "active",
                  "dataArchiving": "P30D"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - node does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Node not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to retrieve node details",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      }
    },
    "/pot": {
      "post": {
        "description": "Create a new pot under a specific node owned by the authenticated user",
        "summary": "Create pot",
        "security": [{ "ApiKeyAuth": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nodeId": { "type": "string", "format": "uuid" },
                  "name": { "type": "string", "maxLength": 50, "minLength": 3 },
                  "note": { "type": "string", "maxLength": 200, "default": "" },
                  "status": { "type": "string", "enum": ["active", "inactive", "unknown"], "default": "unknown" },
                  "reportingTime": {
                    "type": "string",
                    "description": "ISO 8601 duration describing how often this pot should report data (e.g. PT15M)."
                  }
                },
                "required": ["nodeId", "name"],
                "additionalProperties": false
              },
              "example": {
                "nodeId": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                "name": "Front Porch Pot",
                "note": "Ivy pot",
                "status": "active",
                "reportingTime": "PT15M"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Pot created successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Pot" },
                "example": {
                  "id": "d3f1a2b4-5c6d-7890-ab12-cd34ef567890",
                  "nodeId": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                  "name": "Front Porch Pot",
                  "note": "Ivy pot",
                  "status": "active",
                  "reportingTime": "PT15M"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid input",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "InvalidInput", "message": "Provided pot data is invalid." }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - node does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Node not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to create pot",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "CreationFailed", "message": "Could not create pot." }
              }
            }
          }
        },
        "tags": ["User"]
      }
    },
    "/node/{nodeId}/heartbeat": {
      "parameters": [
        {
          "name": "nodeId",
          "in": "path",
          "required": true,
          "schema": { "type": "string", "format": "uuid" },
          "description": "Identifier of the node"
        }
      ],
      "post": {
        "description": "Node heartbeat: return node data and its pots. Node-authenticated (device token).",
        "summary": "Node heartbeat",
        "security": [{ "ApiKeyAuthNode": [] }],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": { "type": "object", "additionalProperties": false },
              "example": {}
            }
          }
        },
        "responses": {
          "200": {
            "description": "Heartbeat accepted - return node and pot state",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "node": { "$ref": "#/components/schemas/Node" },
                    "pots": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/Pot" }
                    }
                  }
                },
                "example": {
                  "node": {
                    "id": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                    "userId": "123e4567-e89b-12d3-a456-426614174000",
                    "name": "Garden Node",
                    "note": "Backyard sensors",
                    "status": "active",
                    "dataArchiving": "P30D"
                  },
                  "pots": [
                    {
                      "id": "d3f1a2b4-5c6d-7890-ab12-cd34ef567890",
                      "nodeId": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                      "name": "Front Porch Pot",
                      "note": "Ivy pot",
                      "status": "active",
                      "reportingTime": "PT15M"
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing node token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing node authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - node does not exist",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Node not found." }
              }
            }
          }
        },
        "tags": ["Node"]
      }
    },
    "/node/{nodeId}/error": {
      "parameters": [
        {
          "name": "nodeId",
          "in": "path",
          "required": true,
          "schema": { "type": "string", "format": "uuid" },
          "description": "Identifier of the node"
        }
      ],
      "post": {
        "description": "Report an error from a node (device).",
        "summary": "Node report error",
        "security": [{ "ApiKeyAuthNode": [] }],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": { "type": "string", "description": "Short error code" },
                  "message": { "type": "string", "description": "Human-readable error message" },
                  "severity": { "type": "string", "enum": ["low", "medium", "high"], "default": "medium" },
                  "timestamp": { "type": "string", "format": "date-time", "description": "When the error occurred" }
                },
                "required": ["code", "message"],
                "additionalProperties": false
              },
              "example": {
                "code": "SENSOR_FAIL",
                "message": "Moisture sensor disconnected",
                "severity": "high",
                "timestamp": "2025-01-01T12:00:00Z"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Error recorded successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/NodeError" },
                "example": {
                  "id": "e1f2d3c4-5b6a-7d8c-9a0b-123456abcdef",
                  "nodeId": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                  "code": "SENSOR_FAIL",
                  "message": "Moisture sensor disconnected",
                  "severity": "high",
                  "timestamp": "2025-01-01T12:00:00Z"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid error payload",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "InvalidInput", "message": "Provided error data is invalid." }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing node token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing node authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - node does not exist",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Node not found." }
              }
            }
          }
        },
        "tags": ["Node"]
      }
    },
    "/node/error": {
      "get": {
        "description": "Get errors reported by nodes owned by the authenticated user. Optional filters: nodeId, timeStart, timeEnd.",
        "summary": "List node errors for user",
        "security": [{ "ApiKeyAuth": [] }],
        "parameters": [
          {
            "name": "nodeId",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "format": "uuid" },
            "description": "Filter errors by node id"
          },
          {
            "name": "timeStart",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "format": "date-time" },
            "description": "Filter start timestamp (ISO 8601)"
          },
          {
            "name": "timeEnd",
            "in": "query",
            "required": false,
            "schema": { "type": "string", "format": "date-time" },
            "description": "Filter end timestamp (ISO 8601)"
          }
        ],
        "responses": {
          "200": {
            "description": "List of node errors",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/NodeError" }
                },
                "example": [
                  {
                    "id": "e1f2d3c4-5b6a-7d8c-9a0b-123456abcdef",
                    "nodeId": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                    "code": "SENSOR_FAIL",
                    "message": "Moisture sensor disconnected",
                    "severity": "high",
                    "timestamp": "2025-01-01T12:00:00Z"
                  }
                ]
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to retrieve node errors",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      }
    },
    "/pot/{potId}": {
      "parameters": [
        {
          "name": "potId",
          "in": "path",
          "required": true,
          "schema": { "type": "string", "format": "uuid" },
          "description": "Identifier of the pot"
        }
      ],
      "get": {
        "description": "Get a specific pot owned by the authenticated user",
        "summary": "Retrieve pot details",
        "security": [
          { "ApiKeyAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "Pot retrieved successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Pot" },
                "example": {
                  "id": "d3f1a2b4-5c6d-7890-ab12-cd34ef567890",
                  "nodeId": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                  "name": "Front Porch Pot",
                  "note": "Ivy pot",
                  "status": "active"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - pot does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Pot not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to retrieve pot",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      },
      "patch": {
        "description": "Update pot fields (name, note, status, reportingTime)",
        "summary": "Partial update of a pot",
        "security": [
          { "ApiKeyAuth": [] }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": { "type": "string", "maxLength": 50, "minLength": 3 },
                  "note": { "type": "string", "maxLength": 200 },
                  "status": { "type": "string", "enum": ["active", "inactive", "unknown"] },
                  "reportingTime": {
                    "type": "string",
                    "description": "ISO 8601 duration describing how often this pot should report data (e.g. PT15M)."
                  }
                },
                "additionalProperties": false
              },
              "example": { "name": "Updated Pot Name", "note": "Updated note", "reportingTime": "PT30M" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Pot updated successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Pot" },
                "example": {
                  "id": "d3f1a2b4-5c6d-7890-ab12-cd34ef567890",
                  "nodeId": "8b3f4c1d-2a7b-4f9a-b2d3-e5f6a7b8c901",
                  "name": "Updated Pot Name",
                  "note": "Updated note",
                  "status": "active"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid update payload",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "InvalidInput", "message": "Provided update data is invalid." }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - pot does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Pot not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to update pot",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      },
      "delete": {
        "description": "Delete a pot owned by the authenticated user",
        "summary": "Delete pot",
        "security": [
          { "ApiKeyAuth": [] }
        ],
        "responses": {
          "204": {
            "description": "Pot deleted successfully - no content"
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - pot does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Pot not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to delete pot",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      }
    },
    "/pot/{potId}/measurement": {
      "parameters": [
        {
          "name": "potId",
          "in": "path",
          "required": true,
          "schema": { "type": "string", "format": "uuid" },
          "description": "Identifier of the pot"
        },
        {
          "name": "timeStart",
          "in": "query",
          "required": false,
          "schema": { "type": "string", "format": "date-time" },
          "description": "Start of time interval (ISO 8601). Optional filter."
        },
        {
          "name": "timeEnd",
          "in": "query",
          "required": false,
          "schema": { "type": "string", "format": "date-time" },
          "description": "End of time interval (ISO 8601). Optional filter."
        }
      ],
      "put": {
        "description": "Add a new measurement to a specific pot (node-authenticated)",
        "summary": "Create measurement for pot",
        "security": [
          { "ApiKeyAuthNode": [] }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "timestamp": { "type": "string", "format": "date-time" },
                  "value": { "type": "number", "minimum": 0, "maximum": 100 },
                  "type": { "type": "string" }
                },
                "required": ["timestamp", "value", "type"],
                "additionalProperties": false
              },
              "example": {
                "timestamp": "2025-01-01T12:00:00Z",
                "value": 45.6,
                "type": "moisture"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Measurement created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Measurement"
                },
                "example": {
                  "id": "a1b2c3d4-5e6f-7a8b-9c0d-ef1234567890",
                  "potId": "d3f1a2b4-5c6d-7890-ab12-cd34ef567890",
                  "timestamp": "2025-01-01T12:00:00Z",
                  "value": 45.6,
                  "type": "moisture"
                }
              }
            }
          },
          "400": {
            "description": "Bad request - invalid measurement data",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "InvalidInput",
                  "message": "Provided measurement data is invalid."
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "Unauthorized",
                  "message": "Invalid or missing authentication token."
                }
              }
            }
          },
          "404": {
            "description": "Not found - pot does not exist or not owned by a user",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                },
                "example": {
                  "error": "NotFound",
                  "message": "Pot not found."
                }
              }
            }
          }
        },
        "tags": ["Node"]
      },
      "get": {
        "description": "Get all measurements for a specific pot, optionally filtered by time range. Returns up to 10,000 measurements ordered by timestamp DESC. For dashboard widgets showing only the latest measurement per type, use GET /pot/{potId}/measurement/latest instead.",
        "summary": "List all measurements for pot",
        "security": [
          { "ApiKeyAuth": [] }
        ],
        "responses": {
          "200": {
            "description": "List of measurements",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Measurement" }
                },
                "example": [
                  {
                    "id": "a1b2c3d4-5e6f-7a8b-9c0d-ef1234567890",
                    "potId": "d3f1a2b4-5c6d-7890-ab12-cd34ef567890",
                    "timestamp": "2025-01-01T12:00:00Z",
                    "value": 45.6,
                    "type": "moisture"
                  }
                ]
              }
            }
          },
          "400": {
            "description": "Bad request - invalid time range",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "InvalidInput", "message": "timeStart/timeEnd format invalid or timeStart > timeEnd." }
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - pot does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Pot not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to retrieve measurements",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ServerError", "message": "An internal error occurred. Please try again later." }
              }
            }
          }
        },
        "tags": ["User"]
      }
    },
    "/pot/{potId}/measurement/latest": {
      "parameters": [
        {
          "name": "potId",
          "in": "path",
          "required": true,
          "schema": { "type": "string", "format": "uuid" },
          "description": "Identifier of the pot"
        }
      ],
      "get": {
        "description": "Get only the latest measurement for each measurement type. Useful for dashboard widgets showing current status.",
        "summary": "Get latest measurements by type",
        "security": [{ "ApiKeyAuth": [] }],
        "responses": {
          "200": {
            "description": "Latest measurement per type",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": { "$ref": "#/components/schemas/Measurement" }
                },
                "example": [
                  {
                    "id": "a1b2c3d4-5e6f-7a8b-9c0d-ef1234567890",
                    "potId": "d3f1a2b4-5c6d-7890-ab12-cd34ef567890",
                    "timestamp": "2025-01-01T12:00:00Z",
                    "value": 45.6,
                    "type": "moisture"
                  }
                ]
              }
            }
          },
          "401": {
            "description": "Unauthorized - invalid or missing token",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "Unauthorized", "message": "Invalid or missing authentication token." }
              }
            }
          },
          "404": {
            "description": "Not found - pot does not exist or not owned by user",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "NotFound", "message": "Pot not found." }
              }
            }
          },
          "500": {
            "description": "Server error - failed to retrieve measurements",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/Error" },
                "example": { "error": "ReadFailed", "message": "Could not list measurements." }
              }
            }
          }
        },
        "tags": ["User"]
      }
    }
  },
  "components": {
    "schemas": {
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "readOnly": true
          },
          "username": {
            "type": "string",
            "maxLength": 30
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "password": {
            "type": "string",
            "format": "sha512",
            "writeOnly": true
          }
        },
        "required": ["id", "username", "email", "password"],
        "example": {
          "id": "123e4567-e89b-12d3-a456-426614174000",
          "username": "john_doe",
          "email": "john_doe+ourApp@gmail.com",
          "password": "86bbad77affad64e370e576118820927a2848c7b2095ac039a770e425e15fba9c0bf9749a5281d11ecedaa52c15a2d9c050986e21898c6e691bbd64fd26dba73"
        },
        "additionalProperties": false
      },
      "Token": {
        "type": "object",
        "properties": {
          "userId": {
            "type": "string",
            "format": "uuid",
            "description": "Reference to the User that owns this token",
            "readOnly": true
          },
          "token": {
            "type": "string",
            "description": "UUID token string"
          },
          "expiration": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp when the token expires",
            "readOnly": true
          }
        },
        "required": ["userId", "token", "expiration"]
      },
      "Node": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "readOnly": true
          },
          "userId": {
            "type": "string",
            "format": "uuid",
            "description": "Reference to the User that owns this node",
            "readOnly": true
          },
          "name": {
            "type": "string",
            "maxLength": 50,
            "minLength": 3,
            "default": "My Node"
          },
          "note": {
            "type": "string",
            "maxLength": 200,
            "default": ""
          },
          "status": {
            "type": "string",
            "enum": ["active", "inactive", "unknown"],
            "default": "unknown"
          },
          "dataArchiving": {
            "type": "string",
            "description": "Duration in ISO 8601 format",
            "default": "P14D"
          }
        },
        "required": ["id", "userId", "status"]
      },
      "NodeToken": {
        "type": "object",
        "properties": {
          "nodeId": {
            "type": "string",
            "format": "uuid",
            "description": "Reference to the Node that owns this token",
            "readOnly": true
          },
          "token": {
            "type": "string",
            "description": "64 character hex token for device authentication"
          }
        },
        "required": ["nodeId", "token"]
      },
      "Pot": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "readOnly": true
          },
          "nodeId": {
            "type": "string",
            "format": "uuid",
            "description": "Reference to the Node that owns this pot",
            "readOnly": true
          },
          "name": {
            "type": "string",
            "maxLength": 50,
            "minLength": 3,
            "default": "My Pot"
          },
          "note": {
            "type": "string",
            "maxLength": 200,
            "default": ""
          },
          "status": {
            "type": "string",
            "enum": ["active", "inactive", "unknown"],
            "default": "unknown"
          },
          "reportingTime": {
            "type": "string",
            "description": "ISO 8601 duration describing how often this pot should report data (e.g. PT15M).",
            "default": "PT15M"
          }
        },
        "required": ["id", "nodeId", "status"]
      },
      "Measurement": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "readOnly": true
          },
          "potId": {
            "type": "string",
            "format": "uuid",
            "description": "Reference to the Pot that owns this measurement",
            "readOnly": true
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "value": {
            "type": "number",
            "format": "float",
            "minimum": 0,
            "maximum": 100
          },
          "type": {
            "type": "string",
            "default": "moisture"
          }
        },
        "required": ["id", "potId", "timestamp", "value", "type"]
      },
      "NodeError": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "format": "uuid",
            "readOnly": true
          },
          "nodeId": {
            "type": "string",
            "format": "uuid",
            "description": "Reference to the node that reported the error",
            "readOnly": true
          },
          "code": { "type": "string", "description": "Short error code" },
          "message": { "type": "string", "description": "Human-readable error message" },
          "severity": { "type": "string", "enum": ["low", "medium", "high"], "default": "medium" },
          "timestamp": { "type": "string", "format": "date-time", "description": "When the error occurred" }
        },
        "required": ["id", "nodeId", "code", "message", "timestamp"]
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string",
            "description": "Short error code"
          },
          "message": {
            "type": "string",
            "description": "Human-readable error message"
          }
        },
        "required": ["error", "message"],
        "example": {
          "error": "CreationFailed",
          "message": "User creation process failed. Check input and try again."
        }
      }
    },
    "securitySchemes": {
      "ApiKeyAuth": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization"
      },
      "ApiKeyAuthNode": {
        "type": "apiKey",
        "in": "header",
        "name": "Authorization",
        "description": "Device token in header: `Bearer <node-token>` (node-scoped, write-capable)."
      }
    }
  }
}
